:root{
  --bg:#0B0F12;        /* deep blue-black */
  --panel:#0D1419;     /* header / panels */
  --card:#121A20;      /* tiles */
  --text:#E7ECEA;      /* primary text */
  --muted:#9AA6A2;     /* secondary text */
  --heading:#DFE8E2;   /* soft mint-white headings */
  --accent:#D2A455;    /* amber accent */
  --accent2:#B5862E;   /* darker amber */
  --chip:#1A2329;      /* chip bg */
}


html,body{margin:0;color:var(--text);background: radial-gradient(1100px 320px at 50% -160px, rgba(210,164,85,0.08), transparent),linear-gradient(var(--bg), var(--bg));font-family:-apple-system,system-ui,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}

/* Glass header */
.header{position:sticky;top:0;z-index:30;background: rgba(13,20,25,0.75);backdrop-filter: blur(16px) saturate(140%);-webkit-backdrop-filter: blur(16px) saturate(140%);border-bottom:1px solid rgba(255,255,255,0.06);padding:calc(8px + env(safe-area-inset-top)) 14px 10px;display:flex;flex-direction:column;align-items:center;gap:6px;}
.header-logo{width:80px;height:auto;display:block;border:none;box-shadow:none;background:transparent}
.subtitle{margin:0;color:var(--muted);font-size:12px}

/* Meta */
.meta-row{ display:flex; gap:10px; align-items:center; justify-content:center; color:rgba(255,255,255,.8); font-size:13px; margin:8px 0 4px; }
.active-filter{color:var(--accent)}

/* Grid & cards */
.main{min-height:100vh;max-width:1100px;margin:0 auto;padding:18px 16px 120px}
.grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
.card{background:var(--card);color:var(--text);border:1px solid rgba(255,255,255,0.06);border-radius:18px;padding:18px;box-shadow:0 14px 36px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,0.03);position:relative;transition: transform 0.35s cubic-bezier(0.22,1,0.36,1),box-shadow 0.35s cubic-bezier(0.22,1,0.36,1);}
.card h3{margin:0 0 6px 0;color:var(--heading);font-size:18px;line-height:1.25;font-weight:600}
.desc{margin:0;color:var(--muted);opacity:.95}
.badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
.badge{background:rgba(255,255,255,0.08);color:var(--text);border:1px solid rgba(255,255,255,0.12);border-radius:999px;padding:7px 14px;font-size:13px;font-weight:600;letter-spacing:.25px;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);box-shadow:0 2px 6px rgba(0,0,0,.15);transition:all .3s cubic-bezier(0.22,1,0.36,1);}

/* Floating SAFE badge */

.safe-badge svg{flex:0 0 auto}

/* Bottom dock (white glass) */
.filter-dock{
  position: fixed; left:0; right:0; bottom: calc(env(safe-area-inset-bottom) + 12px);
  z-index:50; display:flex; justify-content:center; pointer-events:none;
}
.dock-inner{
  pointer-events:auto; display:flex; align-items:center; gap:10px; padding:8px 10px;
  background: rgba(255,255,255,0.18);
  backdrop-filter: blur(14px) saturate(160%);
  -webkit-backdrop-filter: blur(14px) saturate(160%);
  border: 1px solid rgba(255,255,255,0.28); border-radius:20px;
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
}
.filter-btn{background:rgba(255,255,255,0.10);color:var(--text);border:1px solid rgba(255,255,255,0.22);border-radius:999px;padding:10px 18px;font-size:14px;font-weight:500;display:inline-flex;align-items:center;gap:8px;backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);box-shadow:0 8px 22px rgba(0,0,0,0.35);transition:all .3s cubic-bezier(0.22,1,0.36,1);}
.filter-btn .dot{ width:8px; height:8px; border-radius:50%; background:#c9a64b; opacity:.8 }

/* Panel slides up (smooth 0.4s) */
.filter-panel { position: fixed; left:0; right:0; bottom: calc(env(safe-area-inset-bottom) + 110px) !important; z-index:49; display:flex; justify-content:center; opacity:0; transform:translateY(8px); pointer-events:none; transition: opacity .4s ease, transform .4s ease; }
.filter-panel.open{ opacity:1; transform:translateY(0); pointer-events:auto; }
.filter-panel .chips{background:rgba(255,255,255,0.06);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:6px 8px;max-width:920px;margin:0 12px;gap:6px;display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;margin-bottom:20px !important;}
.filter-panel .chips::-webkit-scrollbar{ display:none; }

/* Pills: default white w/ gold outline + gold text; active gold w/ white */
.chip{padding:6px 10px;font-size:12px;border-radius:999px;background:rgba(255,255,255,0.08);color:var(--text);border:1px solid rgba(255,255,255,.10);box-shadow:0 0 5px rgba(0,0,0,.12);white-space:nowrap;}
.chip b{ margin-right:6px }
.chip.active{background:var(--accent);border-color:var(--accent2);color:#121212;box-shadow:0 0 8px rgba(210,164,85,.35)}

.footer{color:#ccc;text-align:center;padding:24px 12px}
.hidden{display:none}

@media (max-width:480px){
  .grid{grid-template-columns:1fr 1fr;gap:12px}
  .card{background:var(--card);color:var(--text);border:1px solid rgba(255,255,255,0.06);border-radius:18px;padding:18px;box-shadow:0 14px 36px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,0.03);position:relative;transition: transform 0.35s cubic-bezier(0.22,1,0.36,1),box-shadow 0.35s cubic-bezier(0.22,1,0.36,1);}
  .header-logo{width:72px}
  .filter-btn{background:rgba(255,255,255,0.10);color:var(--text);border:1px solid rgba(255,255,255,0.22);border-radius:999px;padding:10px 18px;font-size:14px;font-weight:500;display:inline-flex;align-items:center;gap:8px;backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);box-shadow:0 8px 22px rgba(0,0,0,0.35);transition:all .3s cubic-bezier(0.22,1,0.36,1);}
  .filter-panel { position: fixed; left:0; right:0; bottom: calc(env(safe-area-inset-bottom) + 110px) !important; z-index:49; display:flex; justify-content:center; opacity:0; transform:translateY(8px); pointer-events:none; transition: opacity .4s ease, transform .4s ease; }
  .filter-panel .chips{background:rgba(255,255,255,0.06);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:6px 8px;max-width:920px;margin:0 12px;gap:6px;display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;margin-bottom:20px !important;}
}

  position: absolute !important;
  top: 10px !important;
  right: 10px !important;
  width: 26px !important;
  height: 26px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;

  background: rgba(64,186,108,0.18) !important;
  border: 1px solid rgba(64,186,108,0.35) !important;
  border-radius: 50% !important;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25) !important;
  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;

  font-size: 0 !important;   
  color: transparent !important;
  overflow: hidden !important;
  text-indent: -9999px !important;
}



/* === FIXED SAFE BADGE (one check only) === */
  position: absolute !important;
  top: 10px !important;
  right: 10px !important;
  width: 26px !important;
  height: 26px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background: rgba(64,186,108,0.18) !important;
  border: 1px solid rgba(64,186,108,0.35) !important;
  border-radius: 50% !important;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25) !important;
  backdrop-filter: blur(6px) !important;
  -webkit-backdrop-filter: blur(6px) !important;
  font-size: 0 !important;
  color: transparent !important;
  text-indent: -9999px !important;
  overflow: hidden !important;
}
  content: "✓" !important;
  font-size: 14px !important;
  font-weight: 700 !important;
  color: #7ED9A0 !important;
  line-height: 1 !important;
}

/* === MORE SPACE BETWEEN PRESETS & FILTER BUTTON === */
.filter-panel { position: fixed; left:0; right:0; bottom: calc(env(safe-area-inset-bottom) + 110px) !important; z-index:49; display:flex; justify-content:center; opacity:0; transform:translateY(8px); pointer-events:none; transition: opacity .4s ease, transform .4s ease; }
.filter-panel .chips {
  margin-bottom: 20px !important;
}

/* === Apple-style Safe badge (inside card) === */
.safe-badge {
  position: absolute !important;
  top: 8px !important;
  right: 8px !important;
  width: 22px !important;
  height: 22px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;

  background: linear-gradient(145deg, #4cd964, #34c759) !important;
  border: none !important;
  border-radius: 50% !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25), 0 0 6px rgba(76,217,100,0.6) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;

  font-size: 0 !important;
  color: transparent !important;
  text-indent: -9999px !important; /* hide any text nodes */
  overflow: hidden !important;
}
.safe-badge::before {
  content: "✓" !important;
  font-size: 13px !important;
  font-weight: 700 !important;
  color: #ffffff !important;
  line-height: 1 !important;
}

/* === Apple-inspired UI polish === */

/* Cards: softer depth, rounder corners, gentle hover */
.card {
  border-radius: 24px !important;
  box-shadow: 0 8px 24px rgba(0,0,0,0.28), inset 0 1px 0 rgba(255,255,255,0.03) !important;
  transition: transform 220ms cubic-bezier(0.22,1,0.36,1), box-shadow 220ms cubic-bezier(0.22,1,0.36,1) !important;
}
.card:hover {
  transform: translateY(-2px) scale(1.01) !important;
  box-shadow: 0 14px 36px rgba(0,0,0,0.32), inset 0 1px 0 rgba(255,255,255,0.03) !important;
}

/* Dock container: cleaner, translucent */
.dock-inner {
  background: rgba(255,255,255,0.72) !important;
  border: none !important;
  border-radius: 22px !important;
  box-shadow: 0 10px 26px rgba(0,0,0,0.28) !important;
  padding: 8px 10px !important;
}

/* Filters button: Apple-style pill */
.filter-btn {
  background: rgba(255,255,255,0.90) !important;
  color: #121212 !important;
  border: none !important;
  border-radius: 999px !important;
  padding: 10px 20px !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15) !important;
  transition: transform .2s ease, box-shadow .2s ease, background .2s ease !important;
  -webkit-tap-highlight-color: transparent;
}
.filter-btn:hover {
  transform: translateY(-1px) !important;
  box-shadow: 0 6px 14px rgba(0,0,0,0.22) !important;
}
.filter-btn:active {
  transform: translateY(0) scale(.99) !important;
}
.filter-btn .dot {
  width: 8px !important;
  height: 8px !important;
  border-radius: 50% !important;
  background: #D2A455 !important; /* amber by default */
  opacity: 1 !important;
}

/* Active state when panel is open */
#filterToggle[aria-expanded="true"] {
  background: rgba(255,255,255,0.95) !important;
  box-shadow: 0 8px 18px rgba(0,0,0,0.25) !important;
}
#filterToggle[aria-expanded="true"] .dot {
  background: #34c759 !important; /* Apple green when active */
}

/* Filter panel chips: crisper glass */
.filter-panel .chips {
  background: rgba(255,255,255,0.10) !important;
  border: 1px solid rgba(255,255,255,0.14) !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25) !important;
  border-radius: 16px !important;
}

/* Keep Apple-style badge inside cards (already defined) but nudge for spacing */
.safe-badge {
  top: 8px !important;
  right: 8px !important;
}

/* === Thicker presets bar & closer to Filters button === */
.filter-panel {
  bottom: calc(env(safe-area-inset-bottom) + 80px) !important; /* was ~110px */
}
.filter-panel .chips {
  padding: 10px 12px !important;     /* thicker bar */
  border-radius: 20px !important; 
  gap: 8px !important;
}
.chip {
  padding: 8px 12px !important;      /* bigger pills */
  font-size: 14px !important;
  border-radius: 999px !important;
}
@media (max-width:480px){
  .filter-panel { bottom: calc(env(safe-area-inset-bottom) + 76px) !important; }
  .filter-panel .chips { padding: 10px 10px !important; border-radius: 18px !important; }
  .chip { padding: 8px 12px !important; font-size: 13.5px !important; }
}

/* === Remove grey dock box and move presets closer === */
.dock-inner {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
}
.filter-panel {
  bottom: calc(env(safe-area-inset-bottom) + 68px) !important; /* closer to Filters button */
}


/* === THEME VARIABLES === */
:root {
  --bg: #0c0f14;        /* default dark */
  --card-bg: #1a1f24;
  --text-color: #ffffff;
  --accent: #4caf50;
}

body.light{
  --bg:#f7f5ef;          /* off-white (warmer) */
  --panel:#f2efe7;       /* subtle warm panel */
  --card:#fff9ef;        /* ivory cards */
  --text:#143d31;        /* deep green text */
  --muted:#3e5a4b;       /* muted green */
  --heading:#103228;     /* stronger heading green */
  --accent:#2f6e4f;      /* accent green */
  --accent2:#265a40;     /* darker accent */
  --chip:#eef3ea;        /* chip bg in light */
}

/* Apply theme variables globally */
html, body {
  background-color: var(--bg);
  color: var(--text-color);
  transition: background 0.3s ease, color 0.3s ease;
}

.card {
  background-color: var(--card-bg);
  color: var(--text-color);
  transition: background 0.3s ease, color 0.3s ease;
}

.theme-btn {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 1000;
  background: var(--card-bg);
  border: none;
  padding: 0.5rem 0.8rem;
  border-radius: 50%;
  font-size: 1.2rem;
  cursor: pointer;
  color: var(--text-color);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  transition: background 0.3s ease, color 0.3s ease;
}

/* === THEME TOGGLE: variables and light mode === */
:root{
  --bg:#0B0F12;
  --panel:#0D1419;
  --card:#121A20;
  --text:#E7ECEA;
  --muted:#667074;
  --heading:#DFE8E2;
  --accent:#34c759;   /* Apple green for accents in dark */
  --accent2:#2aa84c;
  --chip:#1A2329;
}

body.light{
  --bg:#f7f5ef;          /* off-white (warmer) */
  --panel:#f2efe7;       /* subtle warm panel */
  --card:#fff9ef;        /* ivory cards */
  --text:#143d31;        /* deep green text */
  --muted:#3e5a4b;       /* muted green */
  --heading:#103228;     /* stronger heading green */
  --accent:#2f6e4f;      /* accent green */
  --accent2:#265a40;     /* darker accent */
  --chip:#eef3ea;        /* chip bg in light */
}

/* Apply variables */
html,body{
  background: radial-gradient(1100px 320px at 50% -160px, rgba(46,107,76,0.08), transparent), linear-gradient(var(--bg), var(--bg));
  color: var(--text);
}

/* Components inherit */
.card{ background: var(--card); color: var(--text); }
.badge{ color: var(--text); }
.subtitle{ color: var(--muted); }
.active-filter{ color: var(--accent); }

/* Filter dock + chips adapt to theme */
.dock-inner{ background: rgba(255,255,255,0.85); }
body.light .dock-inner{ background: rgba(0,0,0,0.06); }
.filter-btn{ color: var(--text); }
.filter-panel .chips{ background: rgba(255,255,255,0.06); border-color: rgba(0,0,0,0.08); }
body.light .filter-panel .chips{ background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.06); }

/* Safe badge keeps Apple style but contrast for light */
body.light .safe-badge{
  background: linear-gradient(145deg, #3ddc84, #34c759) !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12), 0 0 6px rgba(76,217,100,0.45) !important;
}

/* Toggle button */
.theme-btn{
  position: fixed;
  top: max(10px, calc(env(safe-area-inset-top) + 8px));
  right: 12px;
  z-index: 1000;
  background: var(--card);
  color: var(--text);
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 999px;
  padding: 8px 10px;
  font-size: 14px;
  line-height: 1;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  cursor: pointer;
  user-select: none;
  transition: transform .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
}
.theme-btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 14px rgba(0,0,0,0.2); }
.theme-btn:active{ transform: translateY(0) scale(.98); }

body.light .card{
  border:1px solid rgba(16,50,40,0.08) !important;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5) !important;
}
body.light .filter-btn{
  background: rgba(255,255,255,0.95) !important;
  color: #143d31 !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12) !important;
}
body.light .dock-inner{
  background: rgba(0,0,0,0.04) !important;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08) !important;
}

/* Light theme header adjustments */
body.light .header {
  background: rgba(255, 255, 255, 0.92) !important;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.04) !important;
  color: #143d31 !important;
}
body.light .header .title,
body.light .header .subtitle {
  color: #143d31 !important;
}

/* === Progressive blur header (both themes) === */
.header {
  background: linear-gradient(
    to bottom,
    rgba(13, 20, 25, 0.80),
    rgba(13, 20, 25, 0.55)
  ) !important;
  backdrop-filter: blur(20px) saturate(150%) !important;
  -webkit-backdrop-filter: blur(20px) saturate(150%) !important;
  box-shadow: 0 6px 16px rgba(0,0,0,0.28) !important;
  transition: background .3s ease, backdrop-filter .3s ease;
}
body.light .header {
  background: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.75),
    rgba(255, 255, 255, 0.55)
  ) !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06) !important;
}

/* Stronger subtitle contrast in light mode */
body.light .subtitle {
  color: #1b3b2f !important;
  opacity: 0.85 !important;
}

/* === Color refinements (safe badge + preset chips) === */

/* Softer, premium green for SAFE mark — dark theme */
.safe-badge {
  background: linear-gradient(145deg, #3ba776, #2f6e4f) !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.22), 0 0 4px rgba(59,167,118,0.35) !important;
}

/* Softer SAFE in light theme too (slightly lighter tones) */
body.light .safe-badge {
  background: linear-gradient(145deg, #47b584, #2f6e4f) !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.12), 0 0 4px rgba(71,181,132,0.30) !important;
}

/* Preset chips: active state in GOLD instead of green */
.chip.active {
  background: #D2A455 !important;   /* golden */
  border-color: #B5862E !important;
  color: #121212 !important;
  box-shadow: 0 0 8px rgba(210,164,85,0.25) !important;
}

/* Keep the Filters button dot golden even when open */
#filterToggle[aria-expanded="true"] .dot {
  background: #D2A455 !important;
}

/* === Smooth scrolling & iOS momentum === */
html { scroll-behavior: smooth; }
.main, .grid {
  -webkit-overflow-scrolling: touch; /* iOS inertial scroll */
}


/* === Card label row & glassy pills === */
.labels{
  display:flex;
  align-items:center;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:8px;
}
/* Base pill */
.pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  font-size:11px;
  font-weight:700;
  border-radius:999px;
  line-height:1;
  user-select:none;
  color:#0f1214;
  background: radial-gradient(120% 140% at 30% 10%, rgba(255,255,255,0.98), rgba(255,255,255,0.90) 60%, rgba(255,255,255,0.86));
  border:1px solid rgba(0,0,0,0.10);
  box-shadow: 0 8px 18px rgba(0,0,0,0.18), inset 0 0 0 0.5px rgba(255,255,255,0.35);
  backdrop-filter: blur(8px) saturate(140%);
  -webkit-backdrop-filter: blur(8px) saturate(140%);
}
/* Category tints */
.pill-dimsum{ background: radial-gradient(120% 140% at 30% 10%, rgba(210,164,85,0.96), rgba(210,164,85,0.86)); }
.pill-starters{ background: radial-gradient(120% 140% at 30% 10%, rgba(120,186,255,0.96), rgba(120,186,255,0.86)); }
.pill-mains{ background: radial-gradient(120% 140% at 30% 10%, rgba(165,235,190,0.96), rgba(165,235,190,0.86)); }
.pill-desserts{ background: radial-gradient(120% 140% at 30% 10%, rgba(255,196,230,0.96), rgba(255,196,230,0.86)); }

/* SAFE indicator (non-overlay) */
.safe-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  font-size:11px;
  font-weight:800;
  border-radius:999px;
  line-height:1;
  color:#0b3d20;
  background: radial-gradient(120% 140% at 30% 10%, rgba(76,217,100,0.95), rgba(52,199,89,0.90));
  border:1px solid rgba(0,0,0,0.10);
  box-shadow: 0 8px 18px rgba(0,0,0,0.18), 0 0 0 0.5px rgba(255,255,255,0.35) inset;
}

/* Disable old overlays */
.cat-label{ display:none !important; }
.safe-badge{ display:none !important; }

/* Ensure badges (allergen chips) never overlap labels */
.card .badges{ margin-top:10px; }


/* === Dock active state highlight === */
.filter-btn[data-active="true"]{
  background: rgba(255,255,255,0.95) !important;
  box-shadow: 0 8px 18px rgba(0,0,0,0.25) !important;
}
.filter-btn[data-active="true"] .dot{ background: #34c759 !important; }
#categoryToggle .dot{ background: #D2A455 !important; }
#categoryToggle[data-active="true"] .dot{ background: #D2A455 !important; }

/* === Category chip subtle tints === */
.chip.category{ font-weight:600; }
.chip-starters{ background: rgba(120,186,255,0.18) !important; border:1px solid rgba(120,186,255,0.32) !important; }
.chip-mains{ background: rgba(165,235,190,0.18) !important; border:1px solid rgba(165,235,190,0.32) !important; }
.chip-dimsums{ background: rgba(210,164,85,0.20) !important; border:1px solid rgba(210,164,85,0.34) !important; }
.chip-desserts{ background: rgba(255,196,230,0.20) !important; border:1px solid rgba(255,196,230,0.34) !important; }
.chip.category.active{ background: var(--accent) !important; color:#121212 !important; border-color: var(--accent2) !important; }

/* === Hard-disable blur inside dish cards === */
.card, .card *{ backdrop-filter: none !important; -webkit-backdrop-filter: none !important; filter: none !important; }

/* === Glass allergen tints (all codes) === */
.chip-ce{background:rgba(120,180,120,0.25);border-color:rgba(120,180,120,0.45);}
.chip-cr{background:rgba(200,100,160,0.25);border-color:rgba(200,100,160,0.45);}
.chip-eg{background:rgba(220,180,80,0.25);border-color:rgba(220,180,80,0.45);}
.chip-fi{background:rgba(90,140,220,0.25);border-color:rgba(90,140,220,0.45);}
.chip-ga{background:rgba(160,180,90,0.25);border-color:rgba(160,180,90,0.45);}
.chip-gl{background:rgba(200,70,70,0.25);border-color:rgba(200,70,70,0.45);}
.chip-mo{background:rgba(150,110,200,0.25);border-color:rgba(150,110,200,0.45);}
.chip-mr{background:rgba(120,100,180,0.25);border-color:rgba(120,100,180,0.45);}
.chip-mu{background:rgba(210,140,70,0.25);border-color:rgba(210,140,70,0.45);}
.chip-mi{background:rgba(70,120,200,0.25);border-color:rgba(70,120,200,0.45);}
.chip-nu{background:rgba(120,200,140,0.25);border-color:rgba(120,200,140,0.45);}
.chip-on{background:rgba(160,120,90,0.25);border-color:rgba(160,120,90,0.45);}
.chip-se{background:rgba(180,160,90,0.25);border-color:rgba(180,160,90,0.45);}
.chip-so{background:rgba(90,180,180,0.25);border-color:rgba(90,180,180,0.45);}


/* === Glassy Dish Modal === */

.modal-close{position:absolute;top:10px;right:12px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);border-radius:10px;padding:2px 8px;font-size:18px;color:#fff;cursor:pointer}
.modal-head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.pill-category{display:none;padding:4px 10px;border-radius:999px;font-size:12px;line-height:1;color:#0c0f14;background:rgba(255,255,255,.88);border:1px solid rgba(255,255,255,.35)}
.badges{display:flex;flex-wrap:wrap;gap:8px}
.modal .chip{backdrop-filter:blur(12px) saturate(160%);-webkit-backdrop-filter:blur(12px) saturate(160%);border-radius:999px;padding:6px 10px;font-size:12px;border:1px solid rgba(255,255,255,.25);color:#fff}

/* Honey tint */
.chip-ho{background:rgba(245,193,108,0.25);border-color:rgba(245,193,108,0.45);}
/* Gold "+" icon button on dock */
.add-btn{
  width: 40px; height: 40px;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius: 999px;
  background: linear-gradient(145deg, #D2A455, #B5862E);
  color: #111;
  font-weight: 800; font-size: 20px; line-height: 1;
  border: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25), 0 0 10px rgba(210,164,85,0.30);
  cursor: pointer;
  transition: transform .18s ease, box-shadow .18s ease;
  -webkit-tap-highlight-color: transparent;
}
.add-btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,0.28), 0 0 12px rgba(210,164,85,0.36); }
.add-btn:active{ transform: translateY(0) scale(.98); }
@media (max-width: 480px){ .dock-inner{ gap:8px; } }

/* === Hotfix: keep text-field styles off checkboxes, fix allergen grid === */
.modal-content input:not([type="checkbox"]), .modal-content textarea{
  box-sizing: border-box; width: 100%; border-radius: 12px;
  border: 1px solid rgba(255,255,255,.22); background: rgba(255,255,255,.10);
  color: #fff; padding: 11px 12px; font-size: 14px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
}
.modal-content input[type="checkbox"]{ width:18px; height:18px; accent-color:#34c759; border:none; background:transparent; box-shadow:none; margin:0; flex:0 0 auto; }
.allergen-fieldset{ overflow:hidden; }
.allergen-list{ display:grid; gap:8px; grid-template-columns: repeat(4, minmax(56px, 1fr)); }
.allergen-list label{ display:flex; align-items:center; gap:10px; font-size:13px; color:#fff; white-space:nowrap; }
@media (max-width: 600px){ .allergen-list{ grid-template-columns: repeat(3, minmax(70px, 1fr)); } }
@media (max-width: 380px){ .allergen-list{ grid-template-columns: repeat(2, minmax(90px, 1fr)); } }


/* ==== Apple Glass Modal — Dark (Option A) ==== */
.modal{
  position: fixed; inset: 0;
  background: radial-gradient(1200px 600px at 50% 10%, rgba(0,0,0,0.55), rgba(0,0,0,0.70));
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex; align-items: center; justify-content: center;
  padding: 24px; z-index: 9999;
}
.modal.hidden{ display:none; }
.modal-content{
  position: relative;
  width: min(92vw, 560px);
  border-radius: 24px;
  padding: 22px 22px 18px;
  color: var(--text);
  background: rgba(17, 22, 26, 0.55);
  box-shadow: 0 24px 60px rgba(0,0,0,0.50), inset 0 0 0 1px rgba(255,255,255,0.06);
  backdrop-filter: blur(24px) saturate(140%);
  -webkit-backdrop-filter: blur(24px) saturate(140%);
  border: 1px solid rgba(255,255,255,0.16);
  transform: translateY(10px);
  opacity: 0;
  animation: modalIn .28s cubic-bezier(.22,1,.36,1) forwards;
}
@keyframes modalIn{ to { transform: translateY(0); opacity: 1; } }
.modal-head{ display:flex; align-items:center; gap:10px; margin-bottom: 14px; }
.modal-head h3{ margin: 0; font-size: 20px; font-weight: 600; color: var(--heading); letter-spacing: .2px; }
.modal-close{
  position: absolute; top: 10px; right: 10px;
  width: 36px; height: 36px; border-radius: 999px;
  display: inline-flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.18);
  color: var(--text);
  box-shadow: 0 8px 18px rgba(0,0,0,0.28), inset 0 0 0 1px rgba(255,255,255,0.06);
  -webkit-tap-highlight-color: transparent;
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.modal-close:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.16); }
.modal-close:active{ transform: translateY(0) scale(.98); }
.form-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 4px; }
.field.wide{ grid-column: 1 / -1; } .field.half{ grid-column: span 1; }
.field{ display:flex; flex-direction: column; gap: 6px; }
.field .lbl{ font-size: 12px; color: rgba(255,255,255,0.75); letter-spacing: .3px; }
.field input, .field textarea{
  width: 100%; background: rgba(255,255,255,0.10);
  color: var(--text); border: 1px solid rgba(255,255,255,0.18);
  border-radius: 14px; padding: 12px 14px; outline: none;
  transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
}
.field textarea{ resize: vertical; min-height: 78px; }
.field input::placeholder, .field textarea::placeholder{ color: rgba(255,255,255,0.55); }
.field input:focus, .field textarea:focus{
  border-color: rgba(210,164,85,0.65);
  box-shadow: 0 0 0 3px rgba(210,164,85,0.18), 0 10px 28px rgba(0,0,0,0.24);
  background: rgba(255,255,255,0.12);
}
.allergen-fieldset{ border: none; padding: 0; margin-top: 6px; }
.allergen-fieldset > legend{ font-size: 12px; margin-bottom: 8px; color: rgba(255,255,255,0.75); }
.allergen-list{ display:grid; gap:8px; grid-template-columns: repeat(4, minmax(56px, 1fr)); }
.allergen-list label{ display:flex; align-items:center; gap:10px; font-size:13px; color:var(--text); white-space:nowrap; }
@media (max-width: 600px){ .allergen-list{ grid-template-columns: repeat(3, minmax(70px, 1fr)); } }
@media (max-width: 380px){ .allergen-list{ grid-template-columns: repeat(2, minmax(90px, 1fr)); } }
.form-actions{ display:flex; align-items:center; justify-content: space-between; gap: 10px; margin-top: 14px; }
.btn{ display:inline-flex; align-items:center; gap:8px; padding: 12px 16px; border-radius: 999px; font-weight: 600; cursor:pointer; border:none; }
.btn svg{ width:18px; height:18px; }
.btn-primary{
  background: linear-gradient(145deg, #D2A455, #B5862E);
  color:#111;
  box-shadow: 0 8px 18px rgba(0,0,0,0.24), 0 0 10px rgba(210,164,85,0.28);
  transition: transform .18s ease, box-shadow .18s ease;
}
.btn-primary:hover{ transform: translateY(-1px); box-shadow: 0 12px 24px rgba(0,0,0,0.28), 0 0 12px rgba(210,164,85,0.36); }
.btn-primary:active{ transform: translateY(0) scale(.98); }
.btn-ghost{
  background: rgba(255,255,255,0.10);
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.18);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}
.btn-ghost:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.14); }
.btn-ghost:active{ transform: translateY(0) scale(.98); }
.hint{ margin: 8px 2px 0; font-size: 12px; color: rgba(255,255,255,0.65); }



/* === Reset button — Apple glass + animation === */
.reset-btn{
  width: 44px; height: 44px; border-radius: 999px;
  display:inline-flex; align-items:center; justify-content:center;
  background: rgba(255,255,255,0.12);
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.20);
  box-shadow: 0 10px 28px rgba(0,0,0,0.35), inset 0 0 0 1px rgba(255,255,255,0.06);
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  transition: transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
  position: relative; overflow: visible;
}
.reset-btn svg{ width:20px; height:20px; display:block; transition: transform .25s ease; }
.reset-btn:hover{ transform: translateY(-1px); }
.reset-btn.active::after{
  content:""; position:absolute; inset:-2px; border-radius:999px;
  background: radial-gradient(circle at center, rgba(210,164,85,0.35), rgba(210,164,85,0.0) 70%);
  filter: blur(2px); opacity: 0; animation: resetPulse 1.8s ease-in-out infinite; pointer-events:none;
}
@keyframes resetPulse{ 0%{ transform: scale(0.92); opacity: 0; } 45%{ transform: scale(1.06); opacity: .55; } 100%{ transform: scale(1.10); opacity: 0; } }
.reset-btn.spin svg{ transform: rotate(360deg); transition: transform .6s cubic-bezier(.22,1,.36,1); }



/* === Shang Shi v4.2 — Glowing Filters (Static Elegance) === */
/* Static glow on active allergen chips (no animation) */
#chips .chip.active,
#chips .chip[aria-pressed="true"] {
  filter: brightness(1.1);
  transform: scale(1.02);
  transition: filter .2s ease, transform .2s ease, box-shadow .2s ease;
  box-shadow: 0 0 8px 2px currentColor;
}

/* Per-allergen color tuning for glow intensity */
#chips .chip.gl.active,  #chips .chip.gl[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(179,58,47,0.60); }
#chips .chip.cr.active,  #chips .chip.cr[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(179,58,47,0.60); }
#chips .chip.eg.active,  #chips .chip.eg[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(255,214,98,0.60); }
#chips .chip.mi.active,  #chips .chip.mi[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(210,164,85,0.55); }
#chips .chip.mu.active,  #chips .chip.mu[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(210,164,85,0.60); }
#chips .chip.so.active,  #chips .chip.so[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(47,110,79,0.60); }
#chips .chip.fi.active,  #chips .chip.fi[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,186,255,0.60); }
#chips .chip.ga.active,  #chips .chip.ga[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(160,180,90,0.55); }
#chips .chip.mo.active,  #chips .chip.mo[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(150,110,200,0.60); }
#chips .chip.mr.active,  #chips .chip.mr[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,100,180,0.60); }
#chips .chip.nu.active,  #chips .chip.nu[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,200,140,0.60); }
#chips .chip.on.active,  #chips .chip.on[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(160,120,90,0.60); }
#chips .chip.se.active,  #chips .chip.se[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(180,160,90,0.60); }
#chips .chip.so.active,  #chips .chip.so[aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(90,180,180,0.60); }

/* Filters button: neutral by default; jade dot when any filter active */
.filter-btn {
  position: relative;
  background: transparent !important;
  background-image: none !important;
}
.filter-dock .filter-btn::after {
  content: '';
  position: absolute;
  top: 9px; right: 9px;
  width: 6px; height: 6px;
  border-radius: 50%;
  background: rgba(255,255,255,0.25);
  transition: background .25s ease, box-shadow .25s ease, transform .2s ease;
}
body.filters-active .filter-dock .filter-btn::after {
  background: #2F6E4F; /* jade */
  box-shadow: 0 0 6px 1px rgba(47,110,79,0.60);
  transform: scale(1.02);
}

/* Prevent gold fill when filters selected (strong override) */
.filter-dock .filter-btn.active,
.filter-dock .filter-btn.is-active,
.filter-dock .filter-btn[aria-pressed="true"],
.filter-dock .filter-btn.selected {
  background: transparent !important;
  background-image: none !important;
}


/* === v4.2.2 — Frosted Filters & Categories Buttons === */
.filter-btn,
.category-btn,
.filters-toggle,
.categories-toggle {
  position: relative;
  backdrop-filter: blur(10px) saturate(120%);
  -webkit-backdrop-filter: blur(10px) saturate(120%);
  background: rgba(20, 20, 20, 0.35);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 40px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  transition: background 0.25s ease, border-color 0.25s ease;
}
body.light .filter-btn,
body.light .category-btn,
body.light .filters-toggle,
body.light .categories-toggle {
  background: rgba(255, 255, 255, 0.40);
  border: 1px solid rgba(0,0,0,0.06);
}
.filter-btn:hover,
.category-btn:hover {
  background: rgba(40,40,40,0.45);
  border-color: rgba(255,255,255,0.12);
}
body.light .filter-btn:hover,
body.light .category-btn:hover {
  background: rgba(255,255,255,0.55);
  border-color: rgba(0,0,0,0.08);
}


/* === v4.2.3 — Robust selectors for chips + frosted buttons === */
/* 1) Active allergen chips: stop any gold fill from legacy rules (handles UPPERCASE class tokens) */
#chips .chip.active,
#chips .chip[aria-pressed="true"],
#chips .chip.is-active,
#chips .chip.selected {
  /* keep existing background; we only add glow/brighten */
  filter: brightness(1.08);
  transform: scale(1.02);
  transition: filter .2s ease, transform .2s ease, box-shadow .2s ease;
}

/* Per-allergen static glow using case-insensitive class matching */
#chips .chip[class*=" gl" i].active,  #chips .chip[class*=" gl" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(200,70,70,.55); }
#chips .chip[class*=" cr" i].active,  #chips .chip[class*=" cr" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(179,58,47,.55); }
#chips .chip[class*=" eg" i].active,  #chips .chip[class*=" eg" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(255,214,98,.55); }
#chips .chip[class*=" fi" i].active,  #chips .chip[class*=" fi" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,186,255,.55); }
#chips .chip[class*=" mi" i].active,  #chips .chip[class*=" mi" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(210,164,85,.50); }
#chips .chip[class*=" mu" i].active,  #chips .chip[class*=" mu" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(210,164,85,.55); }
#chips .chip[class*=" so" i].active,  #chips .chip[class*=" so" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(47,110,79,.55); }
#chips .chip[class*=" mo" i].active,  #chips .chip[class*=" mo" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(150,110,200,.55); }
#chips .chip[class*=" mr" i].active,  #chips .chip[class*=" mr" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,100,180,.55); }
#chips .chip[class*=" nu" i].active,  #chips .chip[class*=" nu" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(120,200,140,.55); }
#chips .chip[class*=" on" i].active,  #chips .chip[class*=" on" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(160,120,90,.55); }
#chips .chip[class*=" se" i].active,  #chips .chip[class*=" se" i][aria-pressed="true"]  { box-shadow: 0 0 8px 2px rgba(180,160,90,.55); }

/* Hard kill any gold fill background override */
#chips .chip.active,
#chips .chip[aria-pressed="true"] {
  background-image: none !important;
}

/* 2) Frosted Filters & Categories using robust selectors (IDs + fallbacks) */
#filterToggle, #categoryToggle,
.dock-inner button[id*="filter" i], .dock-inner button[id*="categ" i],
.filter-btn, .category-btn {
  position: relative;
  backdrop-filter: blur(10px) saturate(120%);
  -webkit-backdrop-filter: blur(10px) saturate(120%);
  background: rgba(20,20,20,0.35);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 40px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  transition: background .25s ease, border-color .25s ease;
}
body.light #filterToggle, body.light #categoryToggle,
body.light .dock-inner button[id*="filter" i], body.light .dock-inner button[id*="categ" i],
body.light .filter-btn, body.light .category-btn {
  background: rgba(255,255,255,0.40);
  border: 1px solid rgba(0,0,0,0.06);
}
#filterToggle:hover, #categoryToggle:hover,
.dock-inner button[id*="filter" i]:hover, .dock-inner button[id*="categ" i]:hover,
.filter-btn:hover, .category-btn:hover {
  background: rgba(40,40,40,0.45);
  border-color: rgba(255,255,255,0.12);
}
body.light #filterToggle:hover, body.light #categoryToggle:hover,
body.light .dock-inner button[id*="filter" i]:hover, body.light .dock-inner button[id*="categ" i]:hover,
body.light .filter-btn:hover, body.light .category-btn:hover {
  background: rgba(255,255,255,0.55);
  border-color: rgba(0,0,0,0.08);
}

/* 3) Filters jade dot retained (if .dot exists) */
body.filters-active #filterToggle .dot,
body.filters-active .filter-btn .dot {
  background: #2F6E4F !important;
  box-shadow: 0 0 6px 1px rgba(47,110,79,.60) !important;
}


/* === SHANG SHI v4.2.4 HOTFIX — chips + frosted buttons (nuclear specificity) === */
#chips .chip.active,
#chips .chip[aria-pressed="true"],
[id*="chips" i] .chip.active,
[id*="chips" i] .chip[aria-pressed="true"],
.filter-panel .chip.active,
.chips .chip.active {
  background: unset !important;
  background-image: none !important;
  border-color: inherit !important;
  filter: brightness(1.08);
  transform: scale(1.02);
  transition: filter .2s ease, transform .2s ease, box-shadow .2s ease;
  box-shadow: 0 0 8px 2px currentColor;
}
#chips .chip[class*=" GL" i].active,  #chips .chip[class*=" GL" i][aria-pressed="true"],
#chips .chip[class*=" CR" i].active,  #chips .chip[class*=" CR" i][aria-pressed="true"],
#chips .chip[class*=" EG" i].active,  #chips .chip[class*=" EG" i][aria-pressed="true"],
#chips .chip[class*=" FI" i].active,  #chips .chip[class*=" FI" i][aria-pressed="true"],
#chips .chip[class*=" MU" i].active,  #chips .chip[class*=" MU" i][aria-pressed="true"],
#chips .chip[class*=" MI" i].active,  #chips .chip[class*=" MI" i][aria-pressed="true"],
#chips .chip[class*=" MO" i].active,  #chips .chip[class*=" MO" i][aria-pressed="true"],
#chips .chip[class*=" MR" i].active,  #chips .chip[class*=" MR" i][aria-pressed="true"],
#chips .chip[class*=" NU" i].active,  #chips .chip[class*=" NU" i][aria-pressed="true"],
#chips .chip[class*=" ON" i].active,  #chips .chip[class*=" ON" i][aria-pressed="true"],
#chips .chip[class*=" SE" i].active,  #chips .chip[class*=" SE" i][aria-pressed="true"],
#chips .chip[class*=" SO" i].active,  #chips .chip[class*=" SO" i][aria-pressed="true"] {
  box-shadow: 0 0 0 1px currentColor, 0 0 10px 2px currentColor;
}
#filterToggle, #categoryToggle,
.dock-inner button[id*="filter" i], .dock-inner button[id*="categ" i],
.filter-btn, .category-btn {
  position: relative;
  backdrop-filter: blur(10px) saturate(120%) !important;
  -webkit-backdrop-filter: blur(10px) saturate(120%) !important;
  background: rgba(20,20,20,0.35) !important;
  border: 1px solid rgba(255,255,255,0.08) !important;
  border-radius: 40px !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.20) !important;
}
body.light #filterToggle, body.light #categoryToggle,
body.light .dock-inner button[id*="filter" i], body.light .dock-inner button[id*="categ" i],
body.light .filter-btn, body.light .category-btn {
  background: rgba(255,255,255,0.40) !important;
  border: 1px solid rgba(0,0,0,0.06) !important;
}
#filterToggle.active, #filterToggle[aria-pressed="true"],
.filter-btn.active,  .filter-btn[aria-pressed="true"] {
  background: inherit !important;
  background-image: none !important;
}
#filterToggle .dot, .filter-btn .dot {
  position: absolute; top: 9px; right: 9px; width: 6px; height: 6px; border-radius: 50%;
  background: rgba(255,255,255,0.25) !important; box-shadow: none !important;
  transition: background .25s ease, box-shadow .25s ease;
}
body.filters-active #filterToggle .dot,
body.filters-active .filter-btn .dot {
  background: #2F6E4F !important; box-shadow: 0 0 6px 1px rgba(47,110,79,.60) !important;
}


/* === v4.2.5 — Off-white frosted dock + brighter active allergens === */

/* A) Filters/Categories: off-white frosted base in both themes */
#filterToggle, #categoryToggle,
.dock-inner button[id*="filter" i], .dock-inner button[id*="categ" i],
.filter-btn, .category-btn {
  position: relative;
  backdrop-filter: blur(10px) saturate(120%) !important;
  -webkit-backdrop-filter: blur(10px) saturate(120%) !important;
  background: rgba(255,255,255,0.88) !important;  /* off-white */
  border: 1px solid rgba(0,0,0,0.12) !important;
  color: #1C1A18 !important;
  border-radius: 40px !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.28) !important;
}
body.light #filterToggle, body.light #categoryToggle,
body.light .dock-inner button[id*="filter" i], body.light .dock-inner button[id*="categ" i],
body.light .filter-btn, body.light .category-btn {
  background: rgba(255,255,255,0.92) !important;
  border: 1px solid rgba(0,0,0,0.10) !important;
}
#filterToggle:hover, #categoryToggle:hover,
.dock-inner button[id*="filter" i]:hover, .dock-inner button[id*="categ" i]:hover,
.filter-btn:hover, .category-btn:hover {
  background: rgba(255,255,255,0.94) !important;
}

/* Keep jade dot behavior (existing .dot span already in HTML) */
body.filters-active #filterToggle .dot,
body.filters-active .filter-btn .dot {
  background: #2F6E4F !important;
  box-shadow: 0 0 6px 1px rgba(47,110,79,.60) !important;
}

/* B) Active allergen chips: brighten in their own color, no gold fill */
#chips .chip, [id*="chips" i] .chip { position: relative; }

/* kill legacy gold fill on active */
#chips .chip.active, #chips .chip[aria-pressed="true"],
[id*="chips" i] .chip.active, [id*="chips" i] .chip[aria-pressed="true"] {
  background: inherit !important;
  background-image: none !important;
  border-color: currentColor !important;
  filter: saturate(1.12) brightness(1.08);
  transform: translateZ(0) scale(1.02);
  box-shadow: 0 0 8px 2px currentColor;
  transition: filter .2s ease, transform .2s ease, box-shadow .2s ease;
}

/* subtle same-color wash to look brighter */
#chips .chip.active::after, #chips .chip[aria-pressed="true"]::after,
[id*="chips" i] .chip.active::after, [id*="chips" i] .chip[aria-pressed="true"]::after {
  content: "";
  position: absolute; inset: 0; border-radius: inherit;
  background: currentColor;
  opacity: .12;
  pointer-events: none;
}


/* === Hotfix v4.2.5.1 — Remove duplicate dot on Filters/Categories === */
#filterToggle::before,
#categoryToggle::before,
.filter-btn::before,
.category-btn::before {
  content: none !important;
}
#filterToggle .dot,
.category-btn .dot,
.filter-btn .dot,
#categoryToggle .dot {
  display: inline-block !important;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-left: 10px;
  background: #2F6E4F !important;
  box-shadow: 0 0 6px 1px rgba(47,110,79,.6);
}


/* === v4.2.6 — Light Theme Modal Polish === */
/* Generic modal selectors to be safe across builds */
.modal, .dialog, .popup, [role="dialog"] {
  backdrop-filter: blur(10px) saturate(120%);
  -webkit-backdrop-filter: blur(10px) saturate(120%);
  transition: background .25s ease, border-color .25s ease, color .25s ease, box-shadow .25s ease;
}

/* Light theme: bright frosted surface */
body.light .modal, 
body.light .dialog, 
body.light .popup, 
body.light [role="dialog"] {
  background: rgba(255,255,255,0.92) !important;
  color: #1C1A18 !important; /* warm ink */
  border: 1px solid rgba(0,0,0,0.08) !important;
  box-shadow: 0 30px 60px rgba(0,0,0,0.20), 0 0 0 1px rgba(0,0,0,0.02);
}

/* Dark theme: keep existing dark panel but ensure readability */
body:not(.light) .modal,
body:not(.light) .dialog,
body:not(.light) .popup,
body:not(.light) [role="dialog"] {
  background: rgba(20,20,22,0.78) !important;
  color: rgba(240,242,245,0.95) !important;
  border: 1px solid rgba(255,255,255,0.06) !important;
}

/* Modal headings & close button tuned for light */
body.light .modal h2, 
body.light .dialog h2, 
body.light .popup h2 {
  color: #1C1A18 !important;
}
body.light .modal .close, 
body.light .dialog .close, 
body.light .popup .close {
  background: rgba(0,0,0,0.05);
  border: 1px solid rgba(0,0,0,0.06);
}

/* Inputs & chips inside the modal for light theme */
body.light .modal input,
body.light .modal select,
body.light .modal textarea,
body.light .dialog input,
body.light .dialog select,
body.light .dialog textarea {
  background: rgba(0,0,0,0.04);
  color: #1C1A18;
  border: 1px solid rgba(0,0,0,0.10);
}

/* Backdrop/overlay tone (slightly softer in light theme) */
.modal-backdrop, .overlay, .backdrop, [data-overlay] {
  transition: background .25s ease;
}
body.light .modal-backdrop, 
body.light .overlay, 
body.light .backdrop, 
body.light [data-overlay] {
  background: rgba(0,0,0,0.25) !important;
}


/* === v4.2.7 — Warm White Dock Edition (flat, dark default) === */

/* A) Dock buttons — flat warm white base */
#filterToggle, #categoryToggle,
.dock-inner button[id*="filter" i], .dock-inner button[id*="categ" i],
.filter-btn, .category-btn {
  position: relative;
  background: #F9F8F6 !important;
  color: #1C1A18 !important;
  border: 1px solid rgba(0,0,0,0.08) !important;
  border-radius: 40px !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
  backdrop-filter: blur(10px) saturate(120%) !important;
  -webkit-backdrop-filter: blur(10px) saturate(120%) !important;
  transition: background 0.25s ease, box-shadow 0.25s ease;
}
#filterToggle:hover, #categoryToggle:hover,
.filter-btn:hover, .category-btn:hover {
  background: #FFFFFF !important;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25) !important;
}

/* Dark mode still default, keep warm white tone visible on dark bg */
body:not(.light) #filterToggle, body:not(.light) #categoryToggle,
body:not(.light) .filter-btn, body:not(.light) .category-btn {
  background: rgba(249,248,246,0.95) !important;
}

/* Keep jade dot indicator as is */
#filterToggle .dot, .filter-btn .dot {
  background: #2F6E4F !important;
  box-shadow: 0 0 6px 1px rgba(47,110,79,.60) !important;
}

/* B) Selected allergens — retain their hue but slightly brighter */
#chips .chip.active, #chips .chip[aria-pressed="true"],
[id*="chips" i] .chip.active, [id*="chips" i] .chip[aria-pressed="true"] {
  filter: saturate(1.15) brightness(1.10);
  transform: translateZ(0) scale(1.02);
  box-shadow: 0 0 10px 2px currentColor;
  background-image: none !important;
  background: inherit !important;
  transition: filter .2s ease, transform .2s ease, box-shadow .2s ease;
}

/* Add a soft overlay wash using their own color */
#chips .chip.active::after, #chips .chip[aria-pressed="true"]::after,
[id*="chips" i] .chip.active::after, [id*="chips" i] .chip[aria-pressed="true"]::after {
  content: "";
  position: absolute; inset: 0; border-radius: inherit;
  background: currentColor;
  opacity: .15;
  pointer-events: none;
}


/* === v4.2.7.1 — Chip accent variables to prevent darkening === */
#chips .chip, [id*="chips" i] .chip {
  --chip-accent: currentColor;
}
#chips .chip.CR,  #chips .chip.cr,  [id*="chips" i] .chip.CR,  [id*="chips" i] .chip.cr { --chip-accent: rgba(179,58,47,1); }
#chips .chip.GL,  #chips .chip.gl,  [id*="chips" i] .chip.GL,  [id*="chips" i] .chip.gl { --chip-accent: rgba(200,70,70,1); }
#chips .chip.EG,  #chips .chip.eg,  [id*="chips" i] .chip.EG,  [id*="chips" i] .chip.eg { --chip-accent: rgba(255,214,98,1); }
#chips .chip.FI,  #chips .chip.fi,  [id*="chips" i] .chip.FI,  [id*="chips" i] .chip.fi { --chip-accent: rgba(120,186,255,1); }
#chips .chip.MU,  #chips .chip.mu,  [id*="chips" i] .chip.MU,  [id*="chips" i] .chip.mu { --chip-accent: rgba(210,164,85,1); }
#chips .chip.SO,  #chips .chip.so,  [id*="chips" i] .chip.SO,  [id*="chips" i] .chip.so { --chip-accent: rgba(47,110,79,1); }
#chips .chip.MI,  #chips .chip.mi,  [id*="chips" i] .chip.MI,  [id*="chips" i] .chip.mi { --chip-accent: rgba(200,170,110,1); }
#chips .chip.NU,  #chips .chip.nu,  [id*="chips" i] .chip.NU,  [id*="chips" i] .chip.nu { --chip-accent: rgba(120,200,140,1); }
#chips .chip.SE,  #chips .chip.se,  [id*="chips" i] .chip.SE,  [id*="chips" i] .chip.se { --chip-accent: rgba(180,160,90,1); }

#chips .chip.active, #chips .chip[aria-pressed="true"],
[id*="chips" i] .chip.active, [id*="chips" i] .chip[aria-pressed="true"] {
  filter: saturate(1.15) brightness(1.10);
  transform: translateZ(0) scale(1.02);
  box-shadow: 0 0 10px 2px var(--chip-accent);
  background-image: none !important;
  background: inherit !important;
}
#chips .chip.active::after, #chips .chip[aria-pressed="true"]::after,
[id*="chips" i] .chip.active::after, [id*="chips" i] .chip[aria-pressed="true"]::after {
  content: "";
  position: absolute; inset: 0; border-radius: inherit;
  background: var(--chip-accent);
  opacity: .15;
  pointer-events: none;
}
